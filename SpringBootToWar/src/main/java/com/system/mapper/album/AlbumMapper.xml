<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.system.mapper.album.AlbumMapper" >

    <resultMap id="alMap" type="com.system.biz.rpc.response.album.AlbumDetailBasicResponse">
        <id column="id" property="id"/>
        <result column="title" property="title" />
        <result column="intro" property="intro" />
        <result column="head_img" property="headImg" />
        <result column="user_id" property="userId" />
        <result column="create_time" property="createTime" />
        <result column="last_update_time" property="lastUpdateTime" />
        <result column="st_count" property="stCount" />
    </resultMap>

    <resultMap id="alStoryMap" type="com.system.biz.rpc.response.album.AlbumDetailStoryResponse">
        <id column="id" property="id"/>
        <result column="st_title" property="stTitle" />
        <result column="st_img" property="stImg" />
        <result column="st_time" property="stTime" />
        <result column="user_id" property="userId" />
        <result column="st_desc" property="stDesc" />
        <result column="play_count" property="playCount" />
        <result column="comment_count" property="commentCount" />
        <result column="share_count" property="shareCount" />
        <result column="collect_count" property="collectCount" />
        <result column="st_href" property="stHref" />
        <result column="pub_time" property="pubTime" />
    </resultMap>


    <select id="getAlbumById" resultMap="alMap" parameterType="java.util.Map">
      SELECT
            id,
            title,
            intro,
            head_img,
            user_id,
            create_time,
            last_update_time,
            st_count
        FROM
            t_album
        WHERE
            id = #{albumId}
    </select>

    <!--获取专辑故事详情-->
    <select id="getAlbumStoryById" resultMap="alStoryMap" parameterType="java.util.Map">
       SELECT
            id,
            st_title,
            st_img,
            st_time,
            user_id,
            st_desc,
            play_count,
            comment_count,
            share_count,
            collect_count,
            st_href,
            pub_time
        FROM
            t_story
        WHERE
            al_id = #{albumId} order by pub_time desc LIMIT #{start},#{size}
    </select>



    <select id="getAlbumStoryCountById" resultType="java.lang.Long" parameterType="java.util.Map">
        SELECT
        count(1)
        FROM
        t_story
        WHERE
        al_id = #{albumId}
    </select>


    <!--获取收藏专辑列表-->
    <select id="getAlbumCollectList" resultMap="alMap" parameterType="java.util.Map">
         SELECT
            ta.id,
            ta.title,
            ta.intro,
            ta.head_img,
            ta.create_time,
            ta.last_update_time,
            ta.st_count
            FROM
            t_album_collect tac
            LEFT JOIN t_album ta ON tac.album_id = ta.id
            WHERE tac.user_id = #{userId}
            order by tac.col_time desc limit #{start},#{size}
    </select>



    <select id="getAlbumCollectListCount" resultType="java.lang.Long">
        SELECT
          count(1)
        FROM
        t_album_collect tac
        LEFT JOIN t_album ta ON tac.album_id = ta.id
        WHERE tac.user_id = #{userId}
    </select>














</mapper>